/**
 * overlay.css - Apple Siri-inspired living planet bubble styling
 * Premium minimal chrome with luminous gradients and responsive motion
 */

:root {
  --hmb-font: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --hmb-text: #f4f6ff;
  --hmb-panel: rgba(8, 10, 18, 0.7);
  --hmb-shadow-soft: 0 14px 32px rgba(10, 14, 28, 0.4);
  --hmb-shadow-strong: 0 26px 60px rgba(10, 14, 28, 0.6);
}

.hmb-root {
  position: fixed;
  bottom: 22px;
  right: 22px;
  z-index: 2147483647;
  font-family: var(--hmb-font);
  pointer-events: none;
  color: var(--hmb-text);
}

.hmb-root[data-position="bottom-left"] {
  left: 22px;
  right: auto;
}

.hmb-root[data-position="top-right"] {
  top: 22px;
  bottom: auto;
}

.hmb-root[data-position="top-left"] {
  top: 22px;
  left: 22px;
  right: auto;
  bottom: auto;
}

.hmb-root[data-theme="warm"] .hmb-bubble {
  --theme-hue: 32deg;
  --theme-saturation: 1.18;
}

.hmb-root[data-theme="neutral"] .hmb-bubble {
  --theme-hue: 0deg;
  --theme-saturation: 0.72;
}

.hmb-root[data-theme="cool"] .hmb-bubble {
  --theme-hue: -6deg;
  --theme-saturation: 1.05;
}

.hmb-root[data-theme="warm"] .hmb-status {
  color: rgba(255, 214, 190, 0.92);
}

.hmb-root[data-theme="neutral"] .hmb-status {
  color: rgba(231, 236, 245, 0.88);
}

.hmb-root[data-theme="cool"] .hmb-status {
  color: rgba(188, 214, 255, 0.9);
}

.hmb-bubble {
  --planet-primary: rgba(126, 158, 255, 0.7);
  --planet-secondary: rgba(68, 204, 255, 0.55);
  --planet-tertiary: rgba(18, 26, 48, 0.92);
  --planet-highlight: rgba(255, 255, 255, 0.55);
  --halo-color: rgba(126, 158, 255, 0.65);
  --halo-color-alt: rgba(186, 120, 255, 0.5);
  --halo-blur: 30px;
  --face-stroke: rgba(255, 255, 255, 0.92);
  --flow-duration: 22s;
  --beat-strength: 0;
  --theme-hue: 0deg;
  --theme-saturation: 1;
  position: relative;
  width: 72px;
  height: 72px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  pointer-events: auto;
  transform: translateZ(0) scale(calc(1 + var(--beat-strength, 0) * 0.05));
  transition: transform 0.6s cubic-bezier(0.33, 1, 0.68, 1), filter 0.6s ease;
  filter: drop-shadow(var(--hmb-shadow-soft)) hue-rotate(var(--theme-hue, 0deg)) saturate(var(--theme-saturation, 1));
  color: var(--face-stroke);
}

.hmb-bubble:hover {
  transform: translateZ(0) scale(calc(1.05 + var(--beat-strength, 0) * 0.05));
  filter: drop-shadow(var(--hmb-shadow-strong)) hue-rotate(var(--theme-hue, 0deg)) saturate(var(--theme-saturation, 1.05));
}

.hmb-bubble.focused {
  --planet-primary: rgba(86, 212, 255, 0.82);
  --planet-secondary: rgba(139, 126, 255, 0.55);
  --planet-tertiary: rgba(12, 24, 52, 0.94);
  --halo-color: rgba(88, 218, 255, 0.7);
  --halo-color-alt: rgba(188, 146, 255, 0.6);
  --flow-duration: 18s;
}

.hmb-bubble.neutral {
  --planet-primary: rgba(126, 158, 255, 0.72);
  --planet-secondary: rgba(94, 220, 255, 0.48);
  --planet-tertiary: rgba(18, 26, 48, 0.92);
  --halo-color: rgba(132, 152, 255, 0.6);
  --halo-color-alt: rgba(186, 160, 255, 0.48);
  --flow-duration: 22s;
}

.hmb-bubble.distracted {
  --planet-primary: rgba(255, 142, 116, 0.86);
  --planet-secondary: rgba(255, 94, 172, 0.55);
  --planet-tertiary: rgba(48, 16, 32, 0.9);
  --halo-color: rgba(255, 118, 128, 0.75);
  --halo-color-alt: rgba(255, 168, 120, 0.6);
  --flow-duration: 15s;
}

.hmb-bubble.idle {
  --planet-primary: rgba(112, 214, 214, 0.78);
  --planet-secondary: rgba(92, 168, 255, 0.48);
  --planet-tertiary: rgba(16, 30, 52, 0.9);
  --halo-color: rgba(104, 206, 198, 0.55);
  --halo-color-alt: rgba(120, 196, 255, 0.42);
  --flow-duration: 26s;
}

.hmb-bubble.upbeat {
  --planet-primary: rgba(255, 94, 214, 0.78);
  --planet-secondary: rgba(94, 224, 255, 0.6);
  --planet-tertiary: rgba(20, 18, 52, 0.92);
  --halo-color: rgba(255, 116, 206, 0.75);
  --halo-color-alt: rgba(118, 214, 255, 0.58);
  --flow-duration: 16s;
}

.hmb-halo {
  position: absolute;
  inset: -32%;
  border-radius: 50%;
  opacity: 0.32;
  pointer-events: none;
  z-index: 1;
  mix-blend-mode: screen;
  transform: scale(calc(0.92 + var(--beat-strength, 0) * 0.25));
  transition: opacity 0.6s ease, transform 0.6s ease;
  background: radial-gradient(circle at center, rgba(255, 255, 255, 0.2), rgba(0, 0, 0, 0));
  filter: blur(calc(var(--halo-blur) * 0.18));
}

.hmb-halo::before,
.hmb-halo::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 50%;
  pointer-events: none;
  mix-blend-mode: screen;
}

.hmb-halo::before {
  background: conic-gradient(from 0deg,
      rgba(255, 255, 255, 0) 0deg,
      var(--halo-color) 50deg,
      rgba(255, 255, 255, 0) 90deg,
      var(--halo-color-alt) 140deg,
      rgba(255, 255, 255, 0) 190deg,
      var(--halo-color) 240deg,
      rgba(255, 255, 255, 0) 320deg,
      var(--halo-color-alt) 360deg);
  filter: blur(calc(var(--halo-blur) * 0.35));
  opacity: 0.7;
  -webkit-mask: radial-gradient(circle, transparent 0 42%, rgba(0, 0, 0, 0.9) 60%, transparent 88%);
  mask: radial-gradient(circle, transparent 0 42%, rgba(0, 0, 0, 0.9) 60%, transparent 88%);
  animation: haloWave 9s linear infinite;
}

.hmb-halo::after {
  background-image:
    radial-gradient(circle, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0) 72%),
    repeating-conic-gradient(from 0deg,
      rgba(255, 255, 255, 0) 0deg 12deg,
      rgba(255, 255, 255, 0.4) 12deg 18deg,
      rgba(255, 255, 255, 0) 18deg 30deg);
  background-size: 120% 120%, 100% 100%;
  filter: blur(calc(var(--halo-blur) * 0.28));
  opacity: 0.5;
  -webkit-mask: radial-gradient(circle, transparent 0 30%, rgba(0, 0, 0, 0.85) 58%, transparent 94%);
  mask: radial-gradient(circle, transparent 0 30%, rgba(0, 0, 0, 0.85) 58%, transparent 94%);
  animation: haloParticles 7s ease-in-out infinite;
}

.hmb-bubble.playing .hmb-halo {
  opacity: 0.62;
  animation: haloPulse calc(1.6s - var(--beat-strength, 0) * 0.6s) ease-in-out infinite;
}

.hmb-bubble.playing .hmb-halo::before {
  animation-duration: calc(8s - var(--beat-strength, 0) * 2s);
}

.hmb-bubble.playing .hmb-halo::after {
  animation-duration: calc(6.5s - var(--beat-strength, 0) * 2s);
}

.hmb-planet-container {
  position: relative;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  overflow: hidden;
  background:
    radial-gradient(circle at 30% 28%, var(--planet-highlight), rgba(255, 255, 255, 0) 55%),
    radial-gradient(circle at 65% 65%, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0) 78%),
    radial-gradient(circle at 50% 55%, var(--planet-tertiary), rgba(0, 0, 0, 0.98));
  box-shadow:
    inset 0 0 40px rgba(255, 255, 255, 0.12),
    inset 0 0 160px rgba(255, 255, 255, 0.08),
    0 18px 36px rgba(10, 14, 32, 0.45);
  animation: planetDrift var(--flow-duration) ease-in-out infinite;
  will-change: transform;
}

.hmb-planet-container::before {
  content: '';
  position: absolute;
  inset: -45%;
  border-radius: 50%;
  background: conic-gradient(from 0deg,
    rgba(255, 255, 255, 0.14) 0%,
    rgba(255, 255, 255, 0) 28%,
    rgba(255, 255, 255, 0.28) 52%,
    rgba(255, 255, 255, 0) 76%,
    rgba(255, 255, 255, 0.2) 100%);
  mix-blend-mode: screen;
  opacity: 0.5;
  animation: auroraSweep calc(var(--flow-duration) * 0.66) linear infinite;
  pointer-events: none;
  z-index: 2;
}

.hmb-planet-container::after {
  content: '';
  position: absolute;
  inset: 6%;
  border-radius: 50%;
  background: radial-gradient(circle at 28% 26%, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0));
  opacity: 0.45;
  mix-blend-mode: screen;
  pointer-events: none;
  z-index: 4;
}

.hmb-planet-glow {
  position: absolute;
  inset: -18%;
  background: radial-gradient(circle at 50% 45%, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0));
  filter: blur(18px);
  opacity: 0.35;
  mix-blend-mode: screen;
  pointer-events: none;
  z-index: 3;
}

.hmb-planet-glass {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0) 55%);
  mix-blend-mode: screen;
  opacity: 0.65;
  pointer-events: none;
  z-index: 5;
}

.planet-canvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  pointer-events: none;
  z-index: 1;
}

.planet-css-fallback {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  pointer-events: none;
  overflow: hidden;
  z-index: 1;
  background:
    radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.28), rgba(255, 255, 255, 0) 55%),
    radial-gradient(circle at 75% 72%, var(--planet-primary), rgba(255, 255, 255, 0) 68%),
    radial-gradient(circle at 38% 68%, var(--planet-secondary), rgba(0, 0, 0, 0) 70%),
    radial-gradient(circle at 50% 50%, var(--planet-tertiary), rgba(0, 0, 0, 0.98));
  animation: planetFlow var(--flow-duration) ease-in-out infinite;
  transform: scale(calc(1 + var(--planet-beat, 0) * 0.04));
}

.planet-has-webgl .planet-css-fallback {
  opacity: 0;
}

.planet-has-css .planet-css-fallback {
  opacity: 1;
}

.hmb-face {
  position: absolute;
  inset: 16%;
  width: 68%;
  height: 68%;
  pointer-events: none;
  z-index: 6;
  color: var(--face-stroke);
  stroke: currentColor;
  stroke-width: 7;
  stroke-linecap: round;
  stroke-linejoin: round;
  fill: none;
  filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.45));
}

.hmb-face__expression {
  opacity: 0;
  transform: translateY(6px) scale(0.96);
  transition: opacity 0.45s cubic-bezier(0.33, 1, 0.68, 1), transform 0.45s cubic-bezier(0.33, 1, 0.68, 1);
}

.hmb-face__eye,
.hmb-face__mouth {
  transform-box: fill-box;
  transform-origin: center;
  animation-fill-mode: both;
}

.hmb-face[data-expression="focused"] .hmb-face__expression--focused,
.hmb-face[data-expression="neutral"] .hmb-face__expression--neutral,
.hmb-face[data-expression="distracted"] .hmb-face__expression--distracted,
.hmb-face[data-expression="idle"] .hmb-face__expression--idle,
.hmb-face[data-expression="upbeat"] .hmb-face__expression--upbeat {
  opacity: 1;
  transform: translateY(0) scale(1);
}

.hmb-face[data-expression="focused"] .hmb-face__expression--focused .hmb-face__mouth {
  animation: mouthBreathe 3.6s ease-in-out infinite;
}

.hmb-face[data-expression="focused"] .hmb-face__expression--focused .hmb-face__eye:nth-of-type(1) {
  animation: eyeBlink 6.2s ease-in-out infinite;
}

.hmb-face[data-expression="focused"] .hmb-face__expression--focused .hmb-face__eye:nth-of-type(2) {
  animation: eyeBlink 6.2s ease-in-out infinite;
  animation-delay: 0.4s;
}

.hmb-face[data-expression="neutral"] .hmb-face__expression--neutral .hmb-face__mouth {
  animation: mouthDrift 4.8s ease-in-out infinite;
}

.hmb-face[data-expression="neutral"] .hmb-face__expression--neutral .hmb-face__eye {
  animation: eyeDrift 5.6s ease-in-out infinite;
}

.hmb-face[data-expression="distracted"] .hmb-face__expression--distracted .hmb-face__mouth {
  animation: mouthWobble 3s ease-in-out infinite;
}

.hmb-face[data-expression="distracted"] .hmb-face__expression--distracted .hmb-face__eye:nth-of-type(1) {
  animation: eyeFlick 2.6s ease-in-out infinite;
}

.hmb-face[data-expression="distracted"] .hmb-face__expression--distracted .hmb-face__eye:nth-of-type(2) {
  animation: eyeFlick 2.6s ease-in-out infinite;
  animation-delay: 0.35s;
}

.hmb-face[data-expression="idle"] .hmb-face__expression--idle .hmb-face__mouth {
  animation: mouthRest 5.6s ease-in-out infinite;
}

.hmb-face[data-expression="idle"] .hmb-face__expression--idle .hmb-face__eye {
  animation: eyeRest 6s ease-in-out infinite;
}

.hmb-face[data-expression="upbeat"] .hmb-face__expression--upbeat .hmb-face__mouth {
  animation: mouthBeam 3.2s ease-in-out infinite;
}

.hmb-face[data-expression="upbeat"] .hmb-face__expression--upbeat .hmb-face__eye {
  animation: eyeSpark 4.4s ease-in-out infinite;
}

.hmb-status {
  margin-top: 14px;
  padding: 10px 16px;
  border-radius: 18px;
  background: var(--hmb-panel);
  color: var(--hmb-text);
  font-size: 0.82rem;
  letter-spacing: 0.01em;
  text-transform: none;
  backdrop-filter: blur(16px) saturate(150%);
  box-shadow: 0 10px 28px rgba(8, 10, 18, 0.5);
  pointer-events: auto;
  text-align: center;
  min-width: 168px;
}

.hmb-status::first-letter {
  text-transform: uppercase;
}

.hmb-bubble.beating {
  filter: drop-shadow(0 18px 48px rgba(30, 60, 120, 0.55));
}

@keyframes haloWave {
  0% {
    transform: rotate(0deg) scale(1);
  }
  50% {
    transform: rotate(180deg) scale(1.04);
  }
  100% {
    transform: rotate(360deg) scale(1);
  }
}

@keyframes haloParticles {
  0% {
    transform: rotate(0deg) scale(0.98);
    opacity: 0.45;
  }
  40% {
    transform: rotate(160deg) scale(1.05);
    opacity: 0.65;
  }
  70% {
    transform: rotate(250deg) scale(1.02);
    opacity: 0.5;
  }
  100% {
    transform: rotate(360deg) scale(0.98);
    opacity: 0.45;
  }
}

@keyframes eyeBlink {
  0%, 86%, 100% {
    transform: scaleY(1);
  }
  88% {
    transform: scaleY(0.1);
  }
  92% {
    transform: scaleY(1.08);
  }
}

@keyframes eyeDrift {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(1.2px);
  }
}

@keyframes eyeFlick {
  0%, 100% {
    transform: translateX(0);
  }
  20% {
    transform: translateX(2px);
  }
  40% {
    transform: translateX(-1.6px);
  }
  60% {
    transform: translateX(1.2px);
  }
}

@keyframes eyeRest {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(1.6px);
  }
}

@keyframes eyeSpark {
  0%, 100% {
    transform: scale(1);
  }
  45% {
    transform: scaleX(1.04) scaleY(1.06);
  }
  60% {
    transform: scaleX(0.96) scaleY(0.94);
  }
}

@keyframes mouthBreathe {
  0%, 100% {
    transform: translateY(0) scaleY(1);
  }
  45% {
    transform: translateY(-1.2px) scaleY(1.08);
  }
}

@keyframes mouthDrift {
  0%, 100% {
    transform: translateY(0) scaleY(1);
  }
  50% {
    transform: translateY(-0.8px) scaleY(1.03);
  }
}

@keyframes mouthWobble {
  0%, 100% {
    transform: translateY(0) scaleX(1);
  }
  40% {
    transform: translateY(1.4px) scaleX(0.97);
  }
  70% {
    transform: translateY(-1.6px) scaleX(1.04);
  }
}

@keyframes mouthRest {
  0%, 100% {
    transform: translateY(0) scaleY(1);
  }
  50% {
    transform: translateY(1.6px) scaleY(0.94);
  }
}

@keyframes mouthBeam {
  0%, 100% {
    transform: translateY(0) scale(1);
  }
  50% {
    transform: translateY(-2px) scale(1.1);
  }
}

@keyframes planetDrift {
  0% {
    transform: rotate(0deg) scale(1.01);
  }
  50% {
    transform: rotate(2deg) scale(1.03);
  }
  100% {
    transform: rotate(-2deg) scale(1.01);
  }
}

@keyframes auroraSweep {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

@keyframes planetFlow {
  0% {
    background-position: 0% 50%, 50% 0%, 50% 100%, 50% 50%;
  }
  50% {
    background-position: 50% 30%, 70% 20%, 30% 80%, 60% 40%;
  }
  100% {
    background-position: 100% 50%, 50% 100%, 50% 0%, 50% 50%;
  }
}

@keyframes haloPulse {
  0%, 100% {
    transform: scale(calc(0.9 + var(--beat-strength, 0) * 0.25));
    opacity: 0.45;
  }
  50% {
    transform: scale(calc(1.05 + var(--beat-strength, 0) * 0.35));
    opacity: 0.75;
  }
}

@media (prefers-reduced-motion: reduce) {
  .hmb-bubble,
  .hmb-halo,
  .hmb-planet-container,
  .planet-css-fallback,
  .hmb-face__expression {
    animation: none !important;
    transition: none !important;
  }

  .hmb-halo::before,
  .hmb-halo::after,
  .hmb-face__eye,
  .hmb-face__mouth {
    animation: none !important;
  }

  .hmb-bubble {
    transform: none !important;
  }

  .hmb-halo {
    opacity: 0.35 !important;
  }
}
